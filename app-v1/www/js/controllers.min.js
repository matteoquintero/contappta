angular.module("starter.controllers",[]).controller("InitCtrl",function(a){var b={controller:"http://www.contappta.com/dashboard/application/controller/app/"};
localStorage.setItem("app",JSON.stringify(b));if(localStorage.getItem("user")!==null){a.go("tab.dash");}else{localStorage.removeItem("events");localStorage.removeItem("user");
localStorage.removeItem("devicetoken");localStorage.removeItem("institution");localStorage.removeItem("photo");a.go("login");}}).controller("LoginCtrl",function(b,a,d,c){b.data={};
b.login=function(){a.loginUser(b.data.username,b.data.password).success(function(e){c.go("tab.dash");}).error(function(f){var e=d.alert({title:"Inicio fallido",template:"Por favor revisa tus credenciales"});
});};}).controller("CloseCtrl",function(b,a,d,c,e){localStorage.clear();localStorage.removeItem("app");localStorage.removeItem("events");localStorage.removeItem("user");
localStorage.removeItem("devicetoken");localStorage.removeItem("institution");localStorage.removeItem("photo");localStorage.clear();a(function(){e.localStorage.clear();
d.clearCache();d.clearHistory();c.debug("clearing cache");b.go("init");},300);}).controller("EventDetailCtrl",function(a,c,b){a.fechaevento=c.dateevent;
b.date(c.dateevent).then(function(d){a.events=d;});}).controller("EventIdDetailCtrl",function(c,e,d){var b=JSON.parse(localStorage.getItem("user")||"{}");
d.eventId(e.idEvent).then(function(f){c.events=f;});var a={user:b.idUsuario,even:e.idEvent,};d.view(a).then();c.doRefresh();}).controller("ContactsCtrl",function(a,b){b.contacts().then(function(c){a.users=c;
});}).controller("DashCtrl",function(b,c){var a=JSON.parse(localStorage.getItem("user")||"{}");var d=JSON.parse(localStorage.getItem("institution")||"{}");
b.institution=d;c.all().then(function(e){b.notices=e;});b.doRefresh();}).controller("TabCtrl",function(a,d,c,b){a.doRefresh=function(){c(function(){b.count().then(function(e){a.data={badgeCountNew:e.news,badgeCountMessage:e.messages,badgeCountEvent:e.events,badgeCountMagazine:e.magazines,badgeCountRecognition:e.recognitions,badgeCountAcount:e.acount};
});},2000);};a.checkTab=function(e){a.doRefresh();d.go("tab."+e);};}).controller("ProfileCtrl",function(c,e,d,a){var b=JSON.parse(localStorage.getItem("user")||"{}");
console.log(b);c.name=b.Nombre==""?"Nombre":b.nombre;c.lastname=b.Apellido==""?"Apellido":b.apellido;c.email=b.Correo==""?"Correo":b.correo;c.updateProfile=function(f){var g={name:c.input.name,lastname:c.input.lastname,email:c.input.email,password:c.input.password,};
a.update(g).then(function(h){d.go("tab.dash");});};}).controller("DashDetailCtrl",function(b,f,e,d,g){var a=JSON.parse(localStorage.getItem("user")||"{}");
d.get(f.noticeId).then(function(h){b.notice=h;});b.sendMessage=function(i){var h={response:b.input.message,user:a.idUsuario,nevv:f.noticeId};g.create(h).then(function(j){e.go("tab.dash");
});};var c={user:a.idUsuario,nevv:f.noticeId,};d.view(c).then();b.doRefresh();}).controller("ChatsCtrl",function(b,g,f,e,d,c){var a=JSON.parse(localStorage.getItem("user")||"{}");
console.log(a);b.user=a;g.all().then(function(h){console.log(h);b.chats=h;});b.remove=function(i){var h=f.confirm({title:"Confirmar",template:"Esta seguro que desea eliminar este contenido"});
h.then(function(k){if(k){var j={conversation:i.idConversacion,};d.kill(j).then(function(l){c.go("tab.dash");});}});};}).controller("ChatDetailCtrl",function(j,i,b,k,d,h,c,a){var g=JSON.parse(localStorage.getItem("user")||"{}");
j.user=g;var e=JSON.parse(localStorage.getItem("app")||"{}");k.get(i.chatId).then(function(l){j.messages=l;});j.takePhoto=function(){navigator.camera.getPicture(l,m,{sourceType:Camera.PictureSourceType.CAMERA,correctOrientation:false,quality:75,targetWidth:200,destinationType:Camera.DestinationType.DATA_URL,encodingType:Camera.EncodingType.PNG,saveToPhotoAlbum:false});
function l(o){var n=c.alert({title:"Mensaje",template:"Foto cargada envia tu mensaje."});localStorage.removeItem("photo");localStorage.setItem("photo",o);
}function m(n){}};j.sendMessage=function(o){var n={message:j.input.message,transmitter:g.idUsuario,reciver:i.userId,conversation:i.chatId,institution:g.idInstitucion};
var m="No";if(localStorage.getItem("photo")){m="Si";}var r="data:image/png;base64,"+localStorage.getItem("photo");localStorage.removeItem("photo");var p=e.controller+"newmessage.php";
var q=true;var l={fileKey:"file",fileName:"photo",mimeType:"image/png",httpMethod:"POST",params:{message:n.message,reciver:n.reciver,transmitter:n.transmitter,conversation:n.conversation,institution:n.institution,photo:m}};
a.upload(encodeURI(p),r,l,q).then(function(s){b.go("tab.chats");j.input.message=null;},function(s){},function(s){});};var f={reciver:g.idUsuario,conversation:i.chatId,};
h.view(f).then();j.doRefresh();}).controller("Son",function(c,d,e,a){e.get(d.user).then(function(f){c.user=f;});a.get(d.user).then(function(f){c.honors=f;
});var b={son:d.user,};e.view(b).then();c.doRefresh();}).controller("Institute",function(a,b){var c=JSON.parse(localStorage.getItem("institution")||"{}");
a.institution=c;}).controller("DataCtrl",function(b,c){var a=JSON.parse(localStorage.getItem("user")||"{}");b.user=a;var d=JSON.parse(localStorage.getItem("institution")||"{}");
b.institution=d;}).controller("AccountCtrl",function(b,f,d,c){c.calender();f.all().then(function(g){b.sons=g;});var a=JSON.parse(localStorage.getItem("user")||"{}");
b.user=a;var e=JSON.parse(localStorage.getItem("institution")||"{}");b.institution=e;}).controller("DateCtrl",function(k,a,f,l){Array.prototype.containsdate=function(n){var m=this.length;
while(m--){if(this[m]["date"].toString()===n.toString()){return true;}}return false;};var d=new Date();var b=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
var j=["Do","Lu","Ma","Mi","Ju","Vi","Sa"];var c=new Date(2015,1,26);var g=new Date(2024,1,26);var h=[];if(localStorage.getItem("events")){var l=JSON.parse(localStorage.getItem("events"));
for(var e=0;e<l.length;e++){h.push({date:new Date(l[e].date)});}}k.onezoneDatepicker={date:d,mondayFirst:true,months:b,daysOfTheWeek:j,startDate:c,endDate:g,disablePastDays:false,disableSwipe:false,disableWeekend:false,showDatepicker:false,showTodayButton:true,calendarMode:true,hideCancelButton:false,hideSetButton:false,highlights:h,callback:function(m){if(h.containsdate(m)){var i=((m.getFullYear())+"-"+(m.getMonth()+1)+"-"+m.getDate());
a.go("tab.event-detail",{dateevent:i},{inherit:false});}}};}).controller("MagazineCtrl",function(a,c,d,b){b.pages(c.magazineId).then(function(e){a.magazines=e;
d.$getByHandle("image-viewer").update();});a.nextMain=function(){d.$getByHandle("image-viewer").next();};a.previousMain=function(){d.$getByHandle("image-viewer").previous();
};a.data={allowScroll:false};b.view(c.magazineId).then();}).controller("MagazinesCtrl",function(a,c,b){b.all().then(function(d){a.magazines=d;c.$getByHandle("image-viewer").update();
});a.nextMain=function(){c.$getByHandle("image-viewer").next();};a.previousMain=function(){c.$getByHandle("image-viewer").previous();};a.data={allowScroll:false};
});